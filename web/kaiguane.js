import{app}from"/scripts/app.js";import{ComfyWidgets}from"/scripts/widgets.js";function updateInputs(e,n){var p=e.inputs.length;if(p<n)for(let t=p+1;t<=n;t++)e.addInput("Input"+t,"*");else if(n<p)for(let t=p;t>n;t--)e.removeInput(t-1);e.properties.inputCount=n}function renderInputNamesTable(e,o){o.innerHTML="";var t=document.createElement("tr"),n=(o.appendChild(t),document.createElement("td")),n=(n.textContent="输入端口数量【Input quantity】:",t.appendChild(n),document.createElement("td"));t.appendChild(n);let p=document.createElement("input");p.type="number",p.value=e.properties.inputCount||2,p.min=2,p.style.width="100%",p.addEventListener("input",()=>{var t=parseInt(p.value);0<t&&t!==e.properties.inputCount&&(updateInputs(e,t),renderInputNamesTable(e,o),app.graph.setDirtyCanvas(!0,!0))}),n.appendChild(p),e.inputs.forEach((e,t)=>{var n=document.createElement("tr"),p=(o.appendChild(n),document.createElement("td")),p=(p.textContent=`Input ${t+1} Name:`,n.appendChild(p),document.createElement("td"));n.appendChild(p);let i=document.createElement("input");i.type="text",i.value=e.name||"Input"+(t+1),i.style.width="100%",i.addEventListener("input",()=>{var t=i.value;e.name=t,app.graph.setDirtyCanvas(!0,!0)}),p.appendChild(i)})}function showSwitchSettings(t){let e=document.createElement("div");e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.padding="20px",e.style.backgroundColor="#333",e.style.color="#fff",e.style.border="1px solid #ccc",e.style.zIndex=1e3,e.style.maxHeight="80%",e.style.overflowY="auto",e.style.width="400px";var n=document.createElement("h3"),n=(n.textContent="2🐕输入设置【Enter settings】",e.appendChild(n),document.createElement("button")),n=(n.textContent="灵仙儿和二狗子",n.style.position="absolute",n.style.top="10px",n.style.right="10px",n.style.backgroundColor="#ff69b4",n.style.color="#fff",n.style.border="none",n.style.padding="5px 10px",n.style.borderRadius="5px",n.style.cursor="pointer",n.addEventListener("click",()=>{window.open("https://space.bilibili.com/19723588?spm_id_from=333.1350.jump_directly","_blank")}),e.appendChild(n),document.createElement("table")),t=(n.style.width="100%",e.appendChild(n),renderInputNamesTable(t,n),document.createElement("button"));t.textContent="关闭【close】",t.style.marginTop="10px",t.addEventListener("click",()=>{document.body.removeChild(e)}),e.appendChild(t),document.body.appendChild(e)}class EGRYDZQHNode{constructor(){this.title="EGRYDZQHNode",this.inputs=[],this.outputs=[],this.properties={inputCount:2,switchName:"EGRYDZQHNode"},this.addInputs(this.properties.inputCount),this.addOutput("Output","*")}addInputs(e){for(let t=2;t<=e;t++){let e="Input"+t;this.inputs.some(t=>t.name===e)||this.addInput(e,"*")}}onExecute(){let e=null;for(let t=0;t<this.inputs.length;t++){var n=this.getInputData(t);if(null!=n){e=n;break}}this.setOutputData(0,e)}onConfigure(t){t&&t.properties&&(this.properties=t.properties),(!this.properties.inputCount||this.properties.inputCount<2)&&(this.properties.inputCount=2),updateInputs(this,this.properties.inputCount)}onSerialize(t){t.properties=this.properties}}app.registerExtension({name:"EGRYDZQHNode",nodes:[EGRYDZQHNode]});let originalGetNodeMenuOptions=LiteGraph.LGraphCanvas.prototype.getNodeMenuOptions;LiteGraph.LGraphCanvas.prototype.getNodeMenuOptions=function(t){var e=originalGetNodeMenuOptions.apply(this,arguments);return"EGRYDZQHNode"===t.type&&e.push({content:"2🐕输入设置【Enter settings】",callback:()=>showSwitchSettings(t)}),e};